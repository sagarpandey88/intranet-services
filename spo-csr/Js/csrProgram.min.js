(function(n){n.renderHomeProgramDetails=function(){n.getAllActiveProgramDetails(function(t){var i=n.getProgramListMarkup(t,CSRUtility.DisplayTypeBox);$("#csr-active-programs").html(i)})};n.getProgramListMarkup=function(n,t){var i="",r="";return r=t=="Box"?'   <div class="col-md-4 col-12">                    <div class="csr-program mb-4 shadow-sm">                       <img src="[IMGURL]" style="width:100%;height:200px" />                      <div class="csr-program-body p-3">                       <p class="csr-program-title">[PROGRAMTITLE]<\/p>                        <p class="csr-program-desc"> [PROGRAMDESCRIPTION]<\/p>                   <p class="csr-program-location"> Location: [PROGRAMLOCATION]<\/p>                        <div class="d-flex justify-content-between align-items-center">                         <div class="btn-group csr-buttons">                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="CSRApp.openViewProgramDetails({{PROGRAMID}})" >View<\/button>                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="CSRApp.openRegisterWithdrawPage({{PROGRAMID}})">Register<\/button>                          <\/div>                          <small class="text-muted csr-days">[DAYSTOGO]<\/small>                        <\/div>                   <\/div>                   <\/div>                   <\/div>       ':"<tr><td>[PROGRAMTITLE]<\/td><td>[PROGRAMDESCRIPTION]<\/td><td>[DAYSTOGO]<\/td><td> <a href='CSRApp.openViewProgramDetails({{PROGRAMID}})'> View <\/a> <\/td><td> <a href='CSRApp.openRegisterWithdrawPage({{PROGRAMID}})'> Register <\/a> <\/td>",$(n).each(function(){var t=this,n=r;n=n.replace("[IMGURL]",t.ImageUrl);n=n.replace("[PROGRAMTITLE]",CSRUtility.substring(t.Title,0,35));n=n.replace("[PROGRAMLOCATION]",CSRUtility.substring(t.Location,0,35));n=n.replace("[PROGRAMDESCRIPTION]",CSRUtility.substring(t.Description,0,75));n=CSRUtility.replaceAllOccurances(n,"{{PROGRAMID}}",t.Id);n=n.replace("[DAYSTOGO]",t.DaysToGo);i+=n}),i};n.renderMyProgramDetails=function(){n.getCurrentUserAllProgramDetails(function(t){n.MyProgramList=t;var i="",r="";$(t).each(function(){var n=this,u=CSRUtility.ViewProgramDetailsServerRelativeUrl+"?progId="+this.Id,t="<li class='list-group-item'><a href="+u+">"+n.Title+"<\/a><\/li>";n.HasEnded?i+=t:r+=t});$("#csr-myactive-program ul").html(r);$("#csr-mypast-program ul").html(i);$(".dvMyPrograms").html(htmlMarkup)})};n.renderViewProgram=function(){var t=parseInt(CSRUtility.getQueryString("progId"));n.getProgramDetails(t,function(i){var r,f,u;if(n.currentProgramDetails=i,$("#csr-program-title").html(i.Title),$("#csr-program-desc").html(i.Description),$("#csr-program-venue").append(i.Venue),$("#csr-program-location").append(i.Location),$("#csr-program-start-date").append(i.EventStartDate.format(CSRUtility.DateFormat)),$("#csr-program-end-date").append(i.EventEndDate.format(CSRUtility.DateFormat)),$("#csr-program-manager").append(i.ProgramManager[0].userName+" ("+i.ProgramManager[0].email+")"),$("#csr-program-ngo").append("<a href=javascript:CSRApp.showNGOModal("+i.NGO.Id+") >"+i.NGO.lookupValue+" <i class='fa fa-eye' aria-hidden=true><\/i> <\/a> "),$("#csr-program-image").attr("src",i.ImageUrl),i.NGO.Id==0&&$("#csr-program-ngo").hide(),CSRUtility.compareDates(i.EventStartDate,i.EventEndDate)==1&&($("#csr-program-start-date").html("<strong>Date :<\/strong>"+i.EventEndDate.format(CSRUtility.DateFormat)+" - "+i.EventEndDate.format(CSRUtility.TimeFormat)),$("#csr-program-end-date").hide()),r=!1,f=!1,i.Volunteers&&i.Volunteers.indexOf(_csrAppContext.CurrentUserId)>-1&&(f=!0),i.VolunteersAttended&&i.VolunteersAttended.indexOf(_csrAppContext.CurrentUserId)>-1&&(r=!0),u="",f&&!r){u="Withdraw";i.IsRegistered=!0;$("#csr-program-action").on("click",function(){return window.confirm("Are you sure you want to withdraw?")&&n.withdrawVolunteer(function(n){n&&(alert("Withdrawn from the event"),window.location.href=CSRUtility.SiteServerRelativeUrl)}),!1})}else if(!f&&!r&&!i.HasEnded){u="Register";i.IsRegistered=!1;$("#csr-program-action").on("click",function(){return CSRUtility.showSPModal("",CSRUtility.ProgramActionServerRelativeUrl+"?progId="+t+"&IsDlg=1",500,450),!1})}if(r){u="Feedback";i.hasAttended=!0;$("#csr-program-action").on("click",function(){var n=CSRUtility.FeedbackPageServerRelativeUrl+"?progId="+t+"&IsDlg=1&Source="+CSRUtility.SiteServerRelativeUrl;return CSRUtility.showSPModal("Feedback",n,600,650,function(){window.location=window.location}),!1});n.checkIfFeedbackSubmitted(function(n){n&&$("#csr-program-action").hide()})}else i.hasAttended=!1;if(i.HasEnded&&$("#csr-program-action").html()==""&&$("#csr-program-action").hide(),$("#csr-program-action").html(u),_csrAppContext.IsCSRAdmin){$("#csr-program-attendance").removeClass("d-none").addClass("d-block");$("#csr-program-edit").removeClass("d-none").addClass("d-block");$("#csr-program-attendance").on("click",function(){window.location=CSRUtility.MarkAttendanceServerRelativeUrl+"?progId="+t+"&IsDlg=1"});$("#csr-program-edit").on("click",function(){var n=window.location.href;window.location=CSRUtility.ProgramEditPageServerRelativeUrl+"?ID="+t+"&Source="+encodeURIComponent(n)})}})};n.renderProgramAction=function(){var t=parseInt(CSRUtility.getQueryString(CSRUtility.ProgramIdQueryString));n.getProgramDetails(t,function(t){n.currentProgramDetails=t;$("#csr-program-title").html(t.Title);$(document).ready(function(){$("#csr-program-start-date").val(t.EventStartDate.format("dd-MMM-yyyy hh:mm"));$("#csr-program-end-date").val(t.EventEndDate.format("dd-MMM-yyyy hh:mm"));$("#csr-program-start-date").datetimepicker({showClose:!0,format:"dd-M-yyyy HH:ii",autoclose:!0,pickerPosition:"bottom",initialDate:t.EventStartDate});$("#csr-program-end-date").datetimepicker({showClose:!0,format:"dd-M-yyyy HH:ii",autoclose:!0,pickerPosition:"bottom",initialDate:t.EventEndDate})});var i="#csr-program-register";if(t.Volunteers&&t.Volunteers.indexOf(_csrAppContext.CurrentUserId)>-1){t.IsRegistered=!0;$(".csr-buttons").prepend("<span style=color:red>You have already registered for this event.<\/span><br/>");$(i).html("Withdraw");$(i).on("click",function(){return window.confirm("Are you sure you want to withdraw?")&&n.withdrawVolunteer(function(n){n&&(alert("Withdrawn from the event"),window.parent.location.href=CSRUtility.SiteServerRelativeUrl)}),!1})}else{t.IsRegistered=!1;$(i).on("click",function(){window.confirm("Are you sure you want to register?")&&n.registerVolunteer(function(n){n&&(alert("Your Registration has been received.You will receive an email shortly."),window.parent.location.href=CSRUtility.SiteServerRelativeUrl)})})}t.VolunteersAttended&&t.VolunteersAttended.indexOf(_csrAppContext.CurrentUserId)>-1&&(t.VolunteersAttended.hasAttended=!0,$(i).hide(),$(i).parent().html("<span class='text-sucess'>You have already attended this program<\/span>"));t.HasEnded&&$(i).hide()})};n.renderRegisterWithdraw=function(){var t=parseInt(CSRUtility.getQueryString("progId"));n.getProgramDetails(t,function(t){n.currentProgramDetails=t;$(".btnRegister").hide();$(".btnWithdraw").hide();t.Volunteers&&t.Volunteers.indexOf(_csrAppContext.CurrentUserId)>-1?($(".btnWithdraw").show(),t.IsRegistered=!0):($(".btnRegister").show(),t.IsRegistered=!1);t.VolunteersAttended&&t.VolunteersAttended.indexOf(_csrAppContext.CurrentUserId)>-1?($(".btnRegister").hide(),$(".btnWithdraw").hide(),t.hasAttended=!0):t.hasAttended=!1;t.HasEnded&&($(".btnRegister").hide(),$(".btnWithdraw").hide());$("#dvProgramTitle").html(t.Title);$("#dvProgramManager").html(t.ProgramManager.userName);$("#dvStartDate").html(t.EventStartDate);$("#dvEndDate").html(t.EventEndDate)})};n.renderProgramAttendanceScreen=function(){var t=parseInt(CSRUtility.getQueryString("progId"));n.getProgramDetails(t,function(t){n.currentProgramDetails=t;$("#dvProgramTitle").html(t.Title)})};n.renderTestimonials=function(t,i){$("#csr-create-testimony").on("click",function(){CSRUtility.showSPModal("Testimony",CSRUtility.AddTestimonyServerRelativeUrl,300,450)});var r="";n.getAllTestimonials(function(n){if(n=CSRUtility.sortArray(n,"Id",!1),i){var u=0;$(n).each(function(){var n=this,i;if(u==t)return!1;n.ShowOnHomePage&&n.Approved&&(i="<div class='col-12 col-lg-3' ><blockquote>"+CSRUtility.substring(n.Testimonial,0,200)+"<\/blockquote><cite>-"+n.Author[0].userName+"<\/cite><\/div>",r+=i,u++)})}else $(n).each(function(){var n=this,t;n.Approved&&(t="<div class='col-12 col-lg-12' ><blockquote>"+n.Testimonial+"<\/blockquote><cite> -"+n.Author[0].userName+"<\/cite><\/div>",r+=t)});$("div.csr-testimonies").html(r)})};n.renderFeedbackPage=function(){$(document).ready(function(){var n=parseInt(CSRUtility.getQueryString("progId"));$("[title=Program]").val(n);$("[title=Program]").hide().parent().prepend($("[title=Program] option:selected")[0].innerText)})};n.renderNGOList=function(){var i='<div class="csr-ngoimg" onclick="CSRApp.showNGOModal([ITEMINDEX])" ><span class="spn_img" > <img src="[IMAGEURL]" alt="logo"><\/span><\/div>',t="";n.ngoList=[];n.getAllNGODetails(function(r){n.ngoList=r;$(r).each(function(){var n=i;n=n.replace("[IMAGEURL]",this.ImageUrl);n=n.replace("[ITEMINDEX]",this.Id);t+=n});$(".csr-ngolist").html(t)})};n.renderNGODetails=function(){var t=CSRUtility.getQueryString("ngoId");n.getNGODetailsById(t,function(t){n.currentNgoDetails=t;$(".csr-ngo-title").html(t.Title);$(".csr-ngo-desc").html(t.Description);$(".csr-ngoimg img").attr("src",t.ImageUrl)})};n.showNGOModal=function(n){var t=CSRUtility.NGODetailsServerRelativeUrl+"?ngoId="+n+"&IsDlg=1";CSRUtility.showSPModal("NGO",t,400,650)};n.renderHomePageSlider=function(){n.getHomePageSliderImages(function(n){var t="",u="<div class='carousel-item [ACTIVE]' ><img src='[IMAGEURL]' style='width:100%;height:400px;'/> <\/div>",f="<li data-target='#csr-carousel' data-slide-to='[INDEX]' class='[ACTIVE]' ><\/li>",i="",r="";$(n).each(function(n){var e=u,o=f;t=n==0?"active":"";e=e.replace("[IMAGEURL]",this.ImageUrl);e=e.replace("[ACTIVE]",t);i+=e;o=o.replace("[INDEX]",n);o=o.replace("[ACTIVE]",t);r+=o});$("#csr-carousel .carousel-inner").html(i);$("#csr-carousel .carousel-indicators").html(r)})};n.renderMarkAttendance=function(){var i=parseInt(CSRUtility.getQueryString("progId")),t="";n.getProgramDetails(i,function(i){var r,u,f;n.currentProgramDetails=i;$("#csr-program-title").html(i.Title);$("#csr-count").html("Registered : "+n.getSplittedValue(n.currentProgramDetails.Volunteers)+" | Attended : "+n.getSplittedValue(n.currentProgramDetails.VolunteersAttended));for(let n in i.VolunteerDetails)r=i.VolunteerDetails[n],r.StartDate=r.StartDate?new Date(r.StartDate).format(CSRUtility.DateFormat):"",r.EndDate=r.EndDate?new Date(r.EndDate).format(CSRUtility.DateFormat):"",u=r.Attended?"checked":"",f="<tr><td>"+r.Username+"<\/td><td>"+r.Userid+" <\/td><td>"+r.StartDate+" <\/td><td>"+r.EndDate+" <\/td><td><input type='checkbox' value='"+r.Userid+"' name='csrAttendance' class='csr-checkbox csr-chkAttendance' "+u+" > <\/td><\/tr>",t+=f;$("#csr-program-attendance tbody").html(t);$(".csr-attendance-selectall").on("click",function(){var n=this.checked;$(".csr-chkAttendance").each(function(){this.checked=n})})})};n.renderReport=function(){n.getReportsHomePage(function(n){$(".csr-report-title").html(n[0].Title);$(".csr-report-desc").html(n[0].Description);$(".csr-report-link").on("click",function(){var t=window.open(n[0].FileUrl,"_blank");return t.focus(),!1})})};n.renderGallery=function(){n.getPictureLibraryImages(CSRUtility.GalleryName,function(t){var i="";$(t).each(function(){var n=this.ImageUrl,t=this.Title,r=' <div class="col-lg-3 col-md-4 col-xs-6 thumb"> <a class="thumbnail" href="#" data-image-id="" data-toggle="modal" data-title="'+t+'" data-image="'+n+'" data-target="#image-gallery"><img class="img-thumbnail" src="'+n+'" alt="Another alt text"><\/a><\/div>';i+=r});$(".csr-gallery .row").html(i);n.galleryModalExtension()})};n.getProgramDetails=function(t,i){var r=CSRUtility.IncludeFieldsProgram;CSRUtility.getItemByIdCurrentContext(CSRUtility.programsListName,t,r,function(t){var r={};r=n.mapProgramDetails(t);i(r)})};n.mapProgramDetails=function(n){var t={},i;return t.Id=n.get_item("ID"),t.Title=n.get_item("Title"),t.Description=n.get_item("ProgramDescription"),t.EventStartDate=n.get_item("EventDate"),t.EventEndDate=n.get_item("EndDate"),t.ProgramManager=CSRUtility.getUserFieldDetails(n,"Program_x0020_Manager"),t.NGO=CSRUtility.getLookupValue(n,"NGO"),t.NeedVolunteers=n.get_item("Need_x0020_Volunteers"),t.VolunteerDetails=JSON.parse(n.get_item("VolunteerDetails")),t.Volunteers=n.get_item("Volunteers"),t.VolunteersAttended=n.get_item("VolunteersAttended"),t.Venue=n.get_item("Venue"),t.Location=n.get_item("ProgramLocation"),t.EmailPara=n.get_item("Email_x0020_Para")==null?"":n.get_item("Email_x0020_Para"),t.DaysToGo=CSRUtility.getDaysToGo(t.EventStartDate),t.HasStarted=CSRUtility.hasDatePassed(t.EventStartDate),t.HasEnded=CSRUtility.hasDatePassed(t.EventEndDate),n.get_attachmentFiles().get_count()>0?(i=n.get_attachmentFiles().getEnumerator(),i.moveNext(),t.ImageUrl=i.get_current().get_serverRelativeUrl()):t.ImageUrl=CSRUtility.DefaultProgramImageUrl,t};n.createProgramDetails=function(){};n.updateProgramDetails=function(){};n.getAllProgramDetails=function(t,i){var r=CSRUtility.IncludeFieldsProgram;CSRUtility.getAllItemsCurrentContext(CSRUtility.programsListName,t,r,function(t){for(var u=[],f=t.getEnumerator(),r,e;f.moveNext();)r={},e=f.get_current(),r=n.mapProgramDetails(e),u.push(r);i(u)})};n.getAllActiveProgramDetails=function(t){n.getAllProgramDetails("<View><Query><Where><And><Geq><FieldRef Name='EventDate' /><Value  Type='DateTime'  IncludeTimeValue='FALSE' ><Today/><\/Value><\/Geq><Eq><FieldRef Name=\"Need_x0020_Volunteers\"/><Value Type=\"Integer\" >1<\/Value><\/Eq><\/And><\/Where><OrderBy><FieldRef Name='ID' Ascending='FALSE'/><\/OrderBy><\/Query><\/View>",t)};n.getCurrentUserAllProgramDetails=function(t){var i=CSRUtility.IncludeFieldsProgram,r=_csrAppContext.CurrentUserId,u='<View><Query><Where><Contains><FieldRef Name="Volunteers"/><Value Type="Text">'+r+"<\/Value><\/Contains><\/Where><OrderBy><FieldRef Name='ID' Ascending='FALSE'/><\/OrderBy><\/Query><\/View>";CSRUtility.getAllItemsCurrentContext(CSRUtility.programsListName,u,i,function(i){for(var u=[],f=i.getEnumerator(),r,e;f.moveNext();)r={},e=f.get_current(),r=n.mapProgramDetails(e),u.push(r);t(u)})};n.registerVolunteer=function(t){var r=new Date($("#csr-program-start-date").val()),u=new Date($("#csr-program-end-date").val()),f=n.currentProgramDetails,i={};return i.CurrentUserId=_csrAppContext.CurrentUserId,i.userDisplayName=_csrAppContext.userDisplayName,i.EmailId=_csrAppContext.currentUser.EmailId,i.startDate=r,i.endDate=u,i.InformManager=$(".csr-checkbox-manager")[0].checked,i.InformManager&&(i.Manager=_csrAppContext.currentUser.Manager),n.addVolunteerInProgram(i,!0,t),!1};n.addVolunteerInProgram=function(t,i,r){var u=n.currentProgramDetails;n.getProgramDetails(u.Id,function(f){var s;n.currentProgramDetails=f;u=f;var o=CSRUtility.getCurrentClientContext(),h=o.get_web().get_lists().getByTitle(CSRUtility.programsListName),e=h.getItemById(u.Id);u.Volunteers=u.Volunteers==null?"":CSRUtility.replaceAllOccurances(u.Volunteers,","+t.CurrentUserId,"");u.VolunteersAttended=u.VolunteersAttended==null?"":CSRUtility.replaceAllOccurances(u.VolunteersAttended,","+t.CurrentUserId,"");s=u.Volunteers+","+t.CurrentUserId;e.set_item("Volunteers",s);u.VolunteerDetails||(u.VolunteerDetails={});u.VolunteerDetails[t.CurrentUserId]={Username:t.userDisplayName,Userid:t.CurrentUserId,EmailId:t.EmailId,StartDate:t.startDate,EndDate:t.endDate,Attended:!1,InformManager:t.InformManager,Manager:t.InformManager?_csrAppContext.currentUser.Manager:""};e.set_item("VolunteerDetails",JSON.stringify(u.VolunteerDetails));e.set_item("VolunteersAttended",u.VolunteersAttended);e.update();o.executeQueryAsync(function(){i?n.addMailTrackerEntry(t.EmailId,"",u,CSRUtility.RegisterType,function(){r(!0)}):r(!0)})})};n.withdrawVolunteer=function(t){var i=n.currentProgramDetails;return n.getProgramDetails(i.Id,function(r){n.currentProgramDetails=r;i=r;var f=CSRUtility.getCurrentClientContext(),e=f.get_web().get_lists().getByTitle(CSRUtility.programsListName),u=e.getItemById(i.Id),o=i.Volunteers.replace(","+_csrAppContext.CurrentUserId,"");u.set_item("Volunteers",o);delete i.VolunteerDetails[_csrAppContext.CurrentUserId];u.set_item("VolunteerDetails",JSON.stringify(i.VolunteerDetails));u.update();f.executeQueryAsync(function(){n.addMailTrackerEntry(_csrAppContext.currentUser.EmailId,"",i,CSRUtility.WithdrawType,function(){t(!0)})},CSRUtility.errorCallback)}),!1};n.markAttendance=function(){var r=n.currentProgramDetails,t=CSRUtility.getCurrentClientContext(),u=t.get_web().get_lists().getByTitle(CSRUtility.programsListName),i=u.getItemById(r.Id);return i.set_item("VolunteersAttended",[]),i.update(),t.executeQueryAsync(function(){successCallback(!0)},CSRUtility.errorCallback),!1};n.addTestimonial=function(){var f=parseInt(CSRUtility.getQueryString("progId")),i=$("#taTestimony").val(),n=new SP.ClientContext,r=n.get_web().get_lists().getByTitle(CSRUtility.TestimonialsListName),u=new SP.ListItemCreationInformation,t=r.addItem(u);t.set_item("Testimonial",i);t.update();n.load(t);n.executeQueryAsync(function(){alert("Testimonial Submitted succesfully for moderation.");SP.UI.ModalDialog.commonModalDialogClose(SP.UI.DialogResult.Cancel)},function(n,t){CSRUtility.errorCallback(n,t,"Error occured addTestimonial")})};n.addFeedback=function(){var n=parseInt(CSRUtility.getQueryString("progId"))};n.openRegisterWithdrawPage=function(n){CSRUtility.showSPModal("Register",CSRUtility.RegisterWithdrawServerRelativeUrl+"?progId="+n+"&IsDlg=1",500,450)};n.openViewProgramDetails=function(n){var t=CSRUtility.ViewProgramDetailsServerRelativeUrl+"?progId="+n;window.location.href=t};n.getAllNGODetails=function(n){CSRUtility.getAllItemsCurrentContext(CSRUtility.ngoListName,CSRUtility.camlQueryAll,CSRUtility.IncludeFieldsNGO,function(t){for(var u=t.getEnumerator(),f=[],i,r;u.moveNext();)i={},r=u.get_current(),i.Id=r.get_item("ID"),i.Title=r.get_item("Title"),i.Description=r.get_item("Description"),i.ImageUrl=CSRUtility.getAttachmentUrl(r),f.push(i);n(f)})};n.getNGODetailsById=function(n,t){CSRUtility.getItemByIdCurrentContext(CSRUtility.ngoListName,n,CSRUtility.IncludeFieldsNGO,function(n){var i={};i.Id=n.get_item("ID");i.Title=n.get_item("Title");i.Description=n.get_item("Description");i.ImageUrl=CSRUtility.getAttachmentUrl(n);t(i)})};n.getAllTestimonials=function(n){CSRUtility.getAllItemsCurrentContext(CSRUtility.testimonialListName,CSRUtility.camlQueryAll,CSRUtility.IncludeFieldsTestimonial,function(t){for(var u=t.getEnumerator(),f=[],i,r;u.moveNext();)i={},r=u.get_current(),i.Id=r.get_item("ID"),i.Title=r.get_item("Title"),i.Testimonial=r.get_item("Testimonial"),i.Approved=r.get_item("IsPublished"),i.ShowOnHomePage=r.get_item("ShowOnHomePage"),i.Author=CSRUtility.getUserFieldDetails(r,"Author"),f.push(i);n(f)})};n.getReportsHomePage=function(n){CSRUtility.getAllItemsCurrentContext(CSRUtility.reportsListName,'<View><Query><Where><Eq><FieldRef Name="ShowonHomePage"/><Value Type="Integer" >1<\/Value><\/Eq><\/Where><\/Query><\/View>',CSRUtility.IncludeFieldsReport,function(t){for(var u=t.getEnumerator(),f=[],i,r;u.moveNext();)i={},r=u.get_current(),i.Id=r.get_item("ID"),i.Title=r.get_item("Title"),i.FileUrl=r.get_item("EncodedAbsUrl"),i.Description=r.get_item("Description0"),f.push(i);n(f)})};n.getHomePageSliderImages=function(n){CSRUtility.getAllItemsCurrentContext(CSRUtility.HomePageSliderLibraryName,CSRUtility.camlQueryAll,CSRUtility.IncludeFieldsHomePageSlider,function(t){for(var u=t.getEnumerator(),f=[],i,r;u.moveNext();)i={},r=u.get_current(),i.Id=r.get_item("ID"),i.Title=r.get_item("Title"),i.ImageUrl=r.get_item("EncodedAbsUrl"),f.push(i);n(f)})};n.getPictureLibraryImages=function(n,t){CSRUtility.getAllItemsCurrentContext(n,CSRUtility.camlQueryAll,CSRUtility.IncludeFieldsHomePageSlider,function(n){for(var u=n.getEnumerator(),f=[],i,r;u.moveNext();)i={},r=u.get_current(),i.Id=r.get_item("ID"),i.Title=r.get_item("Title"),i.ImageUrl=r.get_item("EncodedAbsUrl"),f.push(i);t(f)})};n.updateProgramAttendance=function(){var t=n.currentProgramDetails;$(".csr-chkAttendance").each(function(){var n=this.value;t.VolunteersAttended==null&&(t.VolunteersAttended="");this.checked?(t.VolunteersAttended.indexOf(n)==-1&&(t.VolunteersAttended=String(t.VolunteersAttended)+","+n),t.VolunteerDetails[n].Attended=!0):(t.VolunteersAttended=CSRUtility.replaceAllOccurances(t.VolunteersAttended,","+n,""),t.VolunteerDetails[n].Attended=!1)});var r=CSRUtility.getCurrentClientContext(),u=r.get_web().get_lists().getByTitle(CSRUtility.programsListName),i=u.getItemById(t.Id);i.set_item("VolunteersAttended",t.VolunteersAttended);i.set_item("VolunteerDetails",JSON.stringify(t.VolunteerDetails));i.update();r.executeQueryAsync(function(){alert("Attendance updated successfully!!");window.location=window.location},CSRUtility.errorCallback)};n.galleryModalExtension=function(){var n=$("#image-gallery");$(document).ready(function(){function n(n,t){$("#show-previous-image, #show-next-image").show();n===t?$("#show-next-image").hide():t===1&&$("#show-previous-image").hide()}function t(t,i){function e(t){let i=t;r=i.data("image-id");$("#image-gallery-title").text(i.data("title"));$("#image-gallery-image").attr("src",i.data("image"));n(u,i.data("image-id"))}let r,f,u=0;$("#show-next-image, #show-previous-image").click(function(){$(this).attr("id")==="show-previous-image"?r--:r++;f=$('[data-image-id="'+r+'"]');e(f)});t==!0&&$("[data-image-id]").each(function(){u++;$(this).attr("data-image-id",u)});$(i).on("click",function(){e($(this))})}t(!0,"a.thumbnail")});$(document).keydown(function(t){switch(t.which){case 37:(n.data("bs.modal")||{})._isShown&&$("#show-previous-image").is(":visible")&&$("#show-previous-image").click();break;case 39:(n.data("bs.modal")||{})._isShown&&$("#show-next-image").is(":visible")&&$("#show-next-image").click();break;default:return}t.preventDefault()})};n.addMailTrackerEntry=function(t,i,r,u,f){n.getMailTemplate(u,function(n){var h=CSRUtility.getQueryString("progId"),c=CSRUtility.ViewProgramDetailsServerRelativeUrl+"?progId="+h,o;n=CSRUtility.replaceAllOccurances(n,"{{ProgramName}}",r.Title);n=CSRUtility.replaceAllOccurances(n,"{{ProgramManager}}",r.ProgramManager[0].userName+"("+r.ProgramManager[0].email+")");n=CSRUtility.replaceAllOccurances(n,"{{EventStartDate}}",r.EventStartDate.format(CSRUtility.DateFormat));n=CSRUtility.replaceAllOccurances(n,"{{EventEndDate}}",r.EventEndDate.format(CSRUtility.DateFormat));n=CSRUtility.replaceAllOccurances(n,"{{Venue}}",r.Venue);n=CSRUtility.replaceAllOccurances(n,"{{Description}}",r.Description);n=CSRUtility.replaceAllOccurances(n,"{{VolunteerName}}",_csrAppContext.currentUser.PrefferedName);n=CSRUtility.replaceAllOccurances(n,"{{ProgramLink}}",c);n=CSRUtility.replaceAllOccurances(n,"{{EmailPara}}",r.EmailPara);o="";switch(u){case CSRUtility.RegisterType:o="CSR - "+r.Title+" : Registration Confirmation";break;case CSRUtility.WithdrawType:o="CSR - "+r.Title+" : Withdrawal Confirmation";break;case CSRUtility.FeedbackType:o="CSR - "+r.Title+" : Feedback"}var s=new SP.ClientContext,l=s.get_web().get_lists().getByTitle(CSRUtility.MailTrackerListName),a=new SP.ListItemCreationInformation,e=l.addItem(a);e.set_item("To",t);e.set_item("Cc",i);e.set_item("Subject",o);e.set_item("Body",n);e.update();s.load(e);s.executeQueryAsync(function(){console.log("Mail tracked successfully");f(!0)},function(n,t){CSRUtility.errorCallback(n,t,"Error occured addMailTrackerEntry");f(!1)})})};n.getMailTemplate=function(n,t){var i="";switch(n){case CSRUtility.RegisterType:i=CSRUtility.SiteServerRelativeUrl+"/siteassets/html/EmailTemplates/registermailtemplate.html";break;case CSRUtility.WithdrawType:i=CSRUtility.SiteServerRelativeUrl+"/siteassets/html/EmailTemplates/WithdrawMailTemplate.html";break;case CSRUtility.FeedbackType:i=CSRUtility.SiteServerRelativeUrl+"/siteassets/html/EmailTemplates/FeedbackMailTemplate.html"}$.get(i,function(n){t(n)})};n.sendEmailForFeedback=function(){var t,e,u;if(window.confirm("Are you sure you want to send feedback email?")){var i=n.currentProgramDetails,r="",f=0;for(let o in i.VolunteerDetails)t=i.VolunteerDetails[o],t.Attended&&(r+=t.EmailId+",",e=t.EmailId,u="",t.InformManager&&(u=t.Manager),n.addMailTrackerEntry(e,u,i,CSRUtility.FeedbackType,function(n){f++;CSRUtility.log(n);f==Object.keys(i.VolunteerDetails).length&&($(".loading").hide(),alert("An email request has been added.It will be sent shortly"))}));r!=""&&CSRUtility.log(r)}};n.exportVolunteerDetails=function(){var u=n.currentProgramDetails,f=[],t,i,r;for(let n in u.VolunteerDetails)t=u.VolunteerDetails[n],f.push([t.Username,t.EmailId,new Date(t.StartDate).format(CSRUtility.DateFormat),new Date(t.EndDate).format(CSRUtility.DateFormat)]);i="Name,EmailId,StartDate,EndDate\n";f.forEach(function(n){i+=n.join(",");i+="\n"});console.log(i);r=document.createElement("a");r.href="data:text/csv;charset=utf-8,"+encodeURI(i);r.target="_blank";r.download=u.Title+"_Volunteers.csv";r.click()};n.addNewVolunteer=function(){$("#csr-addnewvolunteer").modal({backdrop:"static"});$("#csr-addnewvolunteer").on("hidden.bs.modal",function(){window.location=window.location})};n.validateVolunteer=function(){var t=$("#csr-empId").val();t!=""&&CSRUtility.getCurrentUserProfilePropertiesFor(t,function(t){var i=CSRUtility.mapUserProfileProperties(t);$(".csr-volunteer-details").html("User Name : "+i.PrefferedName+" Email: "+i.EmailId);n.validatedUser=i;$("#csr-btn-submitVolunteer").show()})};n.submitNewVolunteer=function(){var i=n.validatedUser,r=n.currentProgramDetails,t={};t.CurrentUserId=i.UserId;t.userDisplayName=i.PrefferedName;t.EmailId=i.EmailId;t.startDate=r.EventStartDate;t.endDate=r.EventEndDate;t.InformManager=!1;n.addVolunteerInProgram(t,!1,function(n){n&&(alert("Volunteer Added Successfully!"),$(".csr-volunteer-details").html(""),$("#csr-empId").val(""),$("#csr-btn-submitVolunteer").hide())})};n.checkIfFeedbackSubmitted=function(t){var i=n.currentProgramDetails,r='<View><Query><Where><And><Eq><FieldRef Name="Author"  LookupId=\'TRUE\' /><Value Type="Integer" >'+_spPageContextInfo.userId+'<\/Value><\/Eq><Eq><FieldRef Name="Program"  LookupId=\'TRUE\' /><Value Type="Integer" >'+i.Id+"<\/Value><\/Eq><\/And><\/Where><OrderBy><FieldRef Name='ID' Ascending='FALSE'/><\/OrderBy><\/Query><\/View>";CSRUtility.getAllItemsCurrentContext(CSRUtility.feedbackListName,r,CSRUtility.IncludeFieldsFeedback,function(n){for(var f=n.getEnumerator(),e=[],i,r,u;f.moveNext();)i={},r=f.get_current(),i.Id=r.get_item("ID"),i.Title=r.get_item("Title"),e.push(i);u=!1;e.length>0&&(u=!0);t(u)})};n.fetchMonthReport=function(){var t=$("#csr-report-month").val(),i=$("#csr-report-year-tab2").val(),r=new Date(i,t,01,00,00,00,0),u=new Date(i,parseInt(t)+1,01,00,00,00,0);n.getReportData(r,u,function(t){t.length==0&&alert("No records found!!");var r="",i={};i.Labels=[];i.Registered=[];i.Attended=[];i.Feedback=[];$(t).each(function(){var t=n.getSplittedValue(this.Volunteers),u=n.getSplittedValue(this.VolunteersAttended);i.Labels.push(this.Title);i.Registered.push(t);i.Attended.push(u);i.Feedback.push(0);r+="<tr><td>"+this.Title+"<\/td><td>"+t+"<\/td><td>"+u+"<\/td><\/tr>"});$("#csr-report-table tbody").html(r);n.configureChart("monthly",null,i)})};n.fetchYearReport=function(){var i=$("#csr-report-year-tab1").val(),r=new Date(i,0,01,00,00,00,0),u=new Date(parseInt(i)+1,0,01,00,00,00,0),t=[0,0,0,0,0,0,0,0,0,0,0,0];n.getReportData(r,u,function(i){$(i).each(function(){var n=this.EventStartDate.getMonth();t[n]=t[n]+1;console.log(t)});n.configureChart("yearly",t,null)})};n.configureChart=function(n,t,i){var u,r,f;if(n=="yearly"){r=document.getElementById("csr-program-chart").getContext("2d");for(let n in Chart.instances)Chart.instances[n].destroy();u=new Chart(r,{type:"bar",data:{labels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],datasets:[{label:"No of Programs",backgroundColor:"#e67e22",borderColor:"#e67e22",data:t}]},options:{scales:{yAxes:[{ticks:{stepSize:1,beginAtZero:!0}}]}}})}else{r=document.getElementById("csr-program-count").getContext("2d");for(let n in Chart.instances)Chart.instances[n].destroy();f=new Chart(r,{type:"bar",data:{labels:i.Labels,datasets:[{label:"Registered",backgroundColor:"#17a2b8",borderColor:"#17a2b8",data:i.Registered},{label:"Attended",backgroundColor:"#ffc107",borderColor:"#ffc107",data:i.Attended}]},options:{scales:{yAxes:[{ticks:{stepSize:1,beginAtZero:!0}}]}}})}};n.getReportData=function(t,i,r){var u="<View><Query><Where><And><And><Geq><FieldRef Name='EventDate' /><Value  Type='DateTime'  IncludeTimeValue='FALSE' >"+t.format(CSRUtility.SPDateFormat)+"<\/Value><\/Geq><Lt><FieldRef Name='EventDate' /><Value  Type='DateTime'  IncludeTimeValue='FALSE' >"+i.format(CSRUtility.SPDateFormat)+"<\/Value><\/Lt><\/And><Eq><FieldRef Name=\"Need_x0020_Volunteers\"/><Value Type=\"Integer\" >1<\/Value><\/Eq><\/And><\/Where><OrderBy><FieldRef Name='ID' Ascending='FALSE'/><\/OrderBy><\/Query><\/View>";n.getAllProgramDetails(u,function(n){r(n)})};n.getSplittedValue=function(n){var t=CSRUtility.trim(n,",").split(",");return t.length==1?t[0]==""?0:t.length:t.length}})(window.CSRApp=window.CSRApp||{});